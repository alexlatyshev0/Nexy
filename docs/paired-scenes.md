# Paired Scenes (paired_with)

## Концепция

Поле `paired_with` связывает две сцены, которые показывают **одну и ту же ситуацию** с разных точек зрения (М и Ж).

> **Важно:** В базе данных НЕТ constraint на разные role_direction — это контролируется при создании сцен.
> Поле `paired_with` — просто UUID ссылка, без bidirectional validation.

### Пример: Ice Play (она водит льдом по нему)

**Одна картинка:** Женщина проводит льдом по телу мужчины

| Сцена | role_direction | Описание |
|-------|----------------|----------|
| `ice-play-she-on-him-give` | `m_to_f` (для него) | "Она проводит кубиком льда по твоему телу" |
| `ice-play-she-on-him-receive` | `f_to_m` (для неё) | "Ты проводишь кубиком льда по его телу" |

Обе сцены связаны через `paired_with` — у них одна картинка, но разные описания и **разные role_direction**.

## Ключевое правило

> **Give и Receive ВСЕГДА имеют РАЗНЫЕ role_direction!**
> - Один партнёр видит `m_to_f` версию
> - Другой партнёр видит `f_to_m` версию

## Паттерны именования

### Формат slug

```
{action}-{who}-{does-what}-{give|receive}
```

Примеры:
- `bondage-he-ties-her-give` — он связывает её, карточка для него
- `bondage-he-ties-her-receive` — он связывает её, карточка для неё
- `bondage-she-ties-him-give` — она связывает его, карточка для неё
- `bondage-she-ties-him-receive` — она связывает его, карточка для него

### Правило role_direction для пар

| Slug паттерн | role_direction | Показывается |
|--------------|----------------|--------------|
| `*-he-*-give` | `m_to_f` | мужчине |
| `*-he-*-receive` | `f_to_m` | женщине |
| `*-she-*-give` | см. описание | тому, кто делает |
| `*-she-*-receive` | см. описание | тому, над кем делают |

**Важно:** role_direction определяется по ОПИСАНИЮ, а не по slug!
- Если описание "Ты делаешь ей..." → `m_to_f` (для мужчины)
- Если описание "Ты делаешь ему..." → `f_to_m` (для женщины)
- Если описание "Она делает тебе..." → `m_to_f` (для мужчины)
- Если описание "Он делает тебе..." → `f_to_m` (для женщины)

## Примеры связанных пар

### Blowjob
```
blowjob-give:    f_to_m (для женщины) — "Ты берёшь его член в рот"
blowjob-receive: m_to_f (для мужчины) — "Она берёт твой член в рот"
```

### Bondage (он связывает её)
```
bondage-he-ties-her-give:    m_to_f (для мужчины) — "Ты связываешь её руки"
bondage-he-ties-her-receive: f_to_m (для женщины) — "Он связывает твои руки"
```

### Ice Play (она водит льдом по нему)
```
ice-play-she-on-him-give:    m_to_f (для мужчины) — "Она проводит льдом по твоему телу"
ice-play-she-on-him-receive: f_to_m (для женщины) — "Ты проводишь льдом по его телу"
```

## Когда НЕ нужны пары

Сцены **разных ситуаций** не связываются:
- `squirting` (solo) — только один участник
- `mutual-masturbation` (mutual) — оба делают одинаково
- `romantic-sex` (mutual) — симметричная ситуация

## Universal сцены

Сцены с `role_direction: universal` не требуют пар:
- `onboarding-public`
- `onboarding-quickie`
- `onboarding-sexting`

## shared_images_with

Поле `shared_images_with` — ссылка на сцену, у которой брать картинки (image_variants).
Отличается от `paired_with`:
- `paired_with` — связь give/receive для одной ситуации
- `shared_images_with` — переиспользование картинок между любыми сценами

## Проверка пар

Запустить для проверки что все пары имеют разные role_direction:
```bash
npx tsx scripts/verify-pairs.ts
```

## Статистика (актуальная)

- **Активные сцены:** 276
- **Неактивные сцены:** 195
- **С paired_with:** 220 (110 пар)
- **Все пары имеют разные role_direction:** ✓
