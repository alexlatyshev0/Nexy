# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Üî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2025-01-20  
**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π 020, 021**

---

## ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø 020: Onboarding Category Column

### –°—Ç–∞—Ç—É—Å: ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è `020_onboarding_category_column.sql` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏: `onboarding_category`, `onboarding_direction` –≤ —Ç–∞–±–ª–∏—Ü—É `scenes`
- ‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ü–µ–Ω –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:**
- ‚úÖ `visual-onboarding/page.tsx`: —Ñ—É–Ω–∫—Ü–∏—è `getCategoryId()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `onboarding_category` —Å fallback –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ slug
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `OnboardingScene` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è: `onboarding_category`, `onboarding_direction`
- ‚úÖ SQL –∑–∞–ø—Ä–æ—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏: —Å—Ç—Ä–æ–∫–∞ 148

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–µ—Ç

---

## ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø 021: Merge Scene Responses

### –°—Ç–∞—Ç—É—Å: ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è `021_merge_scene_responses.sql` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `composite_scene_responses` —É–¥–∞–ª–µ–Ω–∞
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `scene_responses`: `scene_slug`, `element_responses`, `skipped`, `updated_at`
- ‚úÖ –î–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ `composite_scene_responses` –≤ `scene_responses`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:**
- ‚úÖ `discover/page.tsx`: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `scene_slug`, `element_responses` –≤ upsert (—Å—Ç—Ä–æ–∫–∏ 1172, 1177, –∏ –¥—Ä.)
- ‚úÖ `scene-progression.ts`: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `scene_slug` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 203)
- ‚úÖ `partner-chat/route.ts`: —á–∏—Ç–∞–µ—Ç `element_responses` (—Å—Ç—Ä–æ–∫–∞ 76)
- ‚úÖ `composite_scene_responses` **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –Ω–∏–≥–¥–µ –≤ –∫–æ–¥–µ

**–ü—Ä–æ–±–ª–µ–º—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
- ‚ö†Ô∏è `docs/database.md` (—Å—Ç—Ä–æ–∫–∏ 191-231) –≤—Å—ë –µ—â—ë –æ–ø–∏—Å—ã–≤–∞–µ—Ç `composite_scene_responses` –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É
- **–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** —É–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª –ø—Ä–æ `composite_scene_responses` –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ —É–¥–∞–ª—ë–Ω–Ω—É—é

---

## ‚úÖ –£–î–ê–õ–ï–ù–ò–ï LEGACY-–ö–û–î–ê

### –°—Ç–∞—Ç—É—Å: ‚úÖ **–£–î–ê–õ–ï–ù–û**

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `BODY_MAP_ACTIVITIES` **–ù–ï –Ω–∞–π–¥–µ–Ω–∞** –≤ `src/` - —É–¥–∞–ª–µ–Ω–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `computeGates()` **–ù–ï –Ω–∞–π–¥–µ–Ω–∞** - —É–¥–∞–ª–µ–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è unified gates)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `composite_scene_responses` **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤ –∫–æ–¥–µ

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–µ—Ç

---

## ‚ö†Ô∏è –ù–ê–ô–î–ï–ù–ù–´–ï –†–ê–°–•–û–ñ–î–ï–ù–ò–Ø

### 1. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è database.md –æ–ø–∏—Å—ã–≤–∞–µ—Ç —É–¥–∞–ª—ë–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É

**–§–∞–π–ª:** `docs/database.md` (—Å—Ç—Ä–æ–∫–∏ 191-231)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –†–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `composite_scene_responses` –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é
- –¢–∞–±–ª–∏—Ü–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ 021

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª `### composite_scene_responses`
- –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª `### scene_responses`, –¥–æ–±–∞–≤–∏–≤ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:
  - `scene_slug TEXT`
  - `element_responses JSONB`
  - `skipped BOOLEAN`
  - `updated_at TIMESTAMPTZ`

**–¢–µ–∫—É—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ `scene_responses` (—Å—Ç—Ä–æ–∫–∞ 160-185):**
- ‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç `elements_selected` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç `follow_up_answers` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ùå –ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç `scene_slug` - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
- ‚ùå –ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç `element_responses` - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å (–∏–ª–∏ —É—Ç–æ—á–Ω–∏—Ç—å —á—Ç–æ —ç—Ç–æ —Ç–æ –∂–µ —á—Ç–æ `follow_up_answers`)
- ‚ùå –ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç `skipped` - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
- ‚ùå –ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç `updated_at` - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

---

## ‚úÖ –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –ò –û–ü–ò–°–ê–ù–ò–Ø

### –ú–∏–≥—Ä–∞—Ü–∏—è 020 (Onboarding Category)
- ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ —è–≤–Ω–æ, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)

### –ú–∏–≥—Ä–∞—Ü–∏—è 021 (Merge Responses)
- ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ö†Ô∏è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)

### –£–¥–∞–ª–µ–Ω–∏–µ Legacy
- ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –∫–æ–¥ —É–¥–∞–ª—ë–Ω
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –û–±–Ω–æ–≤–∏—Ç—å database.md

**–†–∞–∑–¥–µ–ª `scene_responses`:**
```sql
CREATE TABLE scene_responses (
  id UUID PRIMARY KEY,
  user_id UUID,
  scene_id UUID,
  scene_slug TEXT,  -- ‚Üê –î–û–ë–ê–í–ò–¢–¨ (–¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ 021)
  
  -- V2 fields
  elements_selected TEXT[],
  element_responses JSONB,  -- ‚Üê –£–¢–û–ß–ù–ò–¢–¨ –∏–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ follow_up_answers
  skipped BOOLEAN,  -- ‚Üê –î–û–ë–ê–í–ò–¢–¨
  
  -- Legacy fields
  liked BOOLEAN,
  rating INTEGER,
  question_asked TEXT,
  question_type TEXT,
  answer JSONB,
  profile_updates JSONB,
  
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ  -- ‚Üê –î–û–ë–ê–í–ò–¢–¨
);
```

**–†–∞–∑–¥–µ–ª `composite_scene_responses`:**
- ‚ùå –£–î–ê–õ–ò–¢–¨ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫:
  > **‚ö†Ô∏è –£–î–ê–õ–ï–ù–û –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ 021** - –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ `scene_responses`

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –í–ï–†–î–ò–ö–¢

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: ‚úÖ **100%** - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- ‚úÖ 020 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ 021 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ Legacy-–∫–æ–¥ —É–¥–∞–ª—ë–Ω

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–¥–µ
- ‚úÖ –°—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: ‚ö†Ô∏è **85%** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–ß—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- ‚ö†Ô∏è `docs/database.md` - –æ–ø–∏—Å–∞–Ω–∏–µ `scene_responses` –Ω–µ–ø–æ–ª–Ω–æ–µ, –æ–ø–∏—Å–∞–Ω–∏–µ `composite_scene_responses` —É—Å—Ç–∞—Ä–µ–ª–æ

---

## üìã –ß–ï–ö–õ–ò–°–¢ –û–ë–ù–û–í–õ–ï–ù–ò–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `docs/database.md` —Ä–∞–∑–¥–µ–ª `scene_responses`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `scene_slug TEXT`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `element_responses JSONB` (–∏–ª–∏ —É—Ç–æ—á–Ω–∏—Ç—å —Å–≤—è–∑—å —Å `follow_up_answers`)
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `skipped BOOLEAN`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `updated_at TIMESTAMPTZ`
- [ ] –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ä–∞–∑–¥–µ–ª `composite_scene_responses` –≤ `docs/database.md`
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ 020 –≤ `docs/database.md` (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)
